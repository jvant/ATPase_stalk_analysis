#!/usr/bin/env tcl

############################################################## 
# 
# Author:               John Vant 
# Email:              jvant@asu.edu 
# Affiliation:   ASU Biodesign Institute 
# Date Created:          200206
# 
############################################################## 
# 
# Usage: 
# 
############################################################## 
# 
# Notes: 
# 
############################################################## 
package require psfgen
resetpsf
topology /home/jvant/Documents/toppar/top_all36_prot.rtf

#set oldpsf [glob *psf]
set oldpsf [lindex $argv 0]
set olddcd [lindex $argv 0]
set newpsf my.psf
mol new $oldpsf
mol addfile $olddcd waitfor -1

sleep 1

set all [atomselect top all]
$all num
$all writepdb tmp.pdb

readpsf $oldpsf
coordpdb tmp.pdb
mol new $oldpsf
mol addfile tmp.pdb

set sel1 [atomselect top "protein"]
set sel2 [atomselect top "not protein"]

set indices [$sel1 get index] 

puts "Your new dcd will have [$sel1 num] atoms"
sleep 4

set file [open my.ind w] 
foreach i $indices { 
    puts $file $i 
} 
  
flush $file 
close $file 

set nseg 1
set chains [lsort -unique [$sel1 get segid]]
puts "$chains"
foreach ch $chains {
    set selch [atomselect top "segid $ch"]
    $selch writepdb chain_$ch.pdb
}

foreach ch $chains {
    set segid V$nseg
    segment $segid {
	first NONE
	last NONE
	pdb chain_$ch.pdb
    }
    coordpdb chain_$ch.pdb $segid
    incr nseg
}

guesscoord
writepsf my.psf
writepdb my.pdb


# foreach segid [$sel2 get segid] {
#     foreach resid [$sel2 get resid] {
# 	foreach atomname [$sel2 get name] { 
#             delatom $segid $resid $atomname
# 	}
#     }
# }


exit


